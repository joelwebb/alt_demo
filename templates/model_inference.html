
{% extends "layout.html" %}

{% block title %}Model Inference{% endblock %}

{% block content %}
<div class="pcoded-main-container">
    <div class="pcoded-content">
        <div class="page-header">
            <div class="page-block">
                <div class="row align-items-center">
                    <div class="col-md-12">
                        <div class="page-header-title">
                            <h5 class="m-b-10">Model Inference</h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Input Form</h5>
                    </div>
                    <div class="card-body">
                        <form id="predictionForm">
                            <div class="form-group">
                              <label for="model_type">Model Type</label>
                              <select class="form-control" id="model_type" name="model_type" required>
                                <option value="">Select a model...</option>
                                <option value="rf">Random Forest</option>
                              </select>
                            </div>
                
                            <div class="form-group">
                              <label for="grade">Grade</label>
                              <input type="number" step="0.5" class="form-control" id="grade" name="grade" placeholder="Enter grade">
                            </div>
                
                            <div class="form-group">
                              <label for="variety_encoded">Variety Encoded</label>
                              <input type="number" class="form-control" id="variety_encoded" name="variety_encoded" placeholder="Variety code">
                            </div>
                
                            <div class="form-group">
                              <label for="year_sold">Year Sold</label>
                              <input type="number" class="form-control" id="year_sold" name="year_sold" placeholder="2023">
                            </div>
                
                            <div class="form-group">
                              <label for="sale_count_per_card">Sale Count per Card</label>
                              <input type="number" class="form-control" id="sale_count_per_card" name="sale_count_per_card" placeholder="5">
                            </div>
                
                            <div class="form-group">
                              <label for="avg_price_per_card">Average Price per Card</label>
                              <input type="number" step="0.01" class="form-control" id="avg_price_per_card" name="avg_price_per_card" placeholder="50.0">
                            </div>
                
                            <div class="form-group">
                              <label for="std_price_per_card">Std. Dev. of Price per Card</label>
                              <input type="number" step="0.01" class="form-control" id="std_price_per_card" name="std_price_per_card" placeholder="10.0">
                            </div>
                
                            <button type="submit" class="btn btn-primary btn-block">Submit Prediction</button>
                          </form>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Prediction Result</h5>
                    </div>
                    <div class="card-body" id="resultCard">
                        <div class="text-center text-muted">
                            <i class="feather icon-info" style="font-size: 48px;"></i>
                            <p class="mt-3">Submit the form to see prediction results</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    document.getElementById("predictionForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const resultCard = document.getElementById("resultCard");
    
      resultCard.innerHTML = `
        <div class="text-center">
          <div class="spinner-border text-primary" role="status"></div>
          <p class="mt-2">Generating prediction...</p>
        </div>
      `;
    
      fetch("/api/predict", {
        method: "POST",
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.error) throw new Error(data.error);
        resultCard.innerHTML = `
          <div class="alert alert-info text-center">
            <h5>${data.model_used}</h5>
            <h3>${data.result}</h3>
            <p class="mt-2">Confidence: ${(data.confidence * 100).toFixed(1)}%</p>
          </div>
        `;
      })
      .catch(err => {
        resultCard.innerHTML = `
          <div class="alert alert-danger text-center">
            <h6>Error</h6>
            <p>${err.message}</p>
          </div>
        `;
      });
    });
    </script>
{% endblock %}
